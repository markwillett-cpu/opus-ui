<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Opus Platform API Documentation</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  margin: 40px;
  max-width: 1000px;
  line-height: 1.6;
  color: #222;
}
h1, h2, h3 {
  margin-top: 40px;
}
code {
  background: #f4f4f4;
  padding: 3px 6px;
  border-radius: 4px;
}
pre {
  background: #f4f4f4;
  padding: 15px;
  overflow-x: auto;
  border-radius: 6px;
}
.section {
  margin-bottom: 50px;
}
.endpoint {
  background: #fafafa;
  border-left: 4px solid #333;
  padding: 15px;
  margin: 20px 0;
}
</style>
</head>
<body>

<h1>Opus Platform API</h1>
<p>Internal API for Opus class categorization and playback management.</p>

<div class="section">
<h2>Architecture</h2>
<pre>
Frontend (Class UI)
        ↓
Laravel Controllers
        ↓
Opus MySQL Database
</pre>
<p>This API is internal-only and runs inside the Opus Laravel application.</p>
</div>

<div class="section">
<h2>Authentication</h2>
<ul>
<li>Uses Opus session authentication (Laravel Sanctum)</li>
<li>Requires valid <code>opus3_session</code> cookie</li>
<li>Write operations require <code>X-XSRF-TOKEN</code> header</li>
<li>No API keys in production</li>
</ul>
</div>

<div class="section">
<h2>Versioning</h2>
<p>Base path:</p>
<pre>/internal/api/v1</pre>
<p>Breaking changes require new version.</p>
</div>

<div class="section">
<h2>Endpoints</h2>

<div class="endpoint">
<h3>GET /internal/api/v1/styles</h3>
<p>Returns all styles.</p>
</div>

<div class="endpoint">
<h3>GET /internal/api/v1/styles/{style_id}/tracks</h3>
<p>Returns tracks for a style, including class assignments.</p>
</div>

<div class="endpoint">
<h3>POST /internal/api/v1/styles/{style_id}/assignments</h3>
<p>Upserts class assignments.</p>
<pre>
{
  "assignments": [
    { "library_song_id": "uuid", "class_code": "A" }
  ]
}
</pre>
</div>

<div class="endpoint">
<h3>POST /internal/api/v1/styles/{style_id}/weights</h3>
<p>Updates class weights.</p>
<pre>
{
  "weights": [
    { "class_code": "A", "weight_pct": 35 },
    { "class_code": "B", "weight_pct": 35 },
    { "class_code": "C", "weight_pct": 30 },
    { "class_code": "REST", "weight_pct": 0 }
  ]
}
</pre>
<p>Total must equal 100.</p>
</div>

</div>

<div class="section">
<h2>Class Codes</h2>
<ul>
<li>A – High priority</li>
<li>B – Core rotation</li>
<li>C – Library depth</li>
<li>REST – On hold</li>
<li>Unassigned – Uncategorized</li>
</ul>
</div>

<div class="section">
<h2>Authorization</h2>
<ul>
<li>Read: Any authenticated Opus user</li>
<li>Write: Restricted roles (Music Admin / Curator)</li>
</ul>
</div>

<div class="section">
<h2>Data Ownership</h2>
<p>The Platform API owns:</p>
<ul>
<li><code>sim_style_song_classes</code></li>
<li><code>sim_style_class_weights</code></li>
</ul>
</div>

<div class="section">
<h2>Status</h2>
<p>Internal Operational Tool – Not Publicly Exposed</p>
</div>

</body>
</html>
